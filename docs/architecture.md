# Архитектура проекта

Этот документ описывает архитектуру проекта Minikube Cluster и его компонентов.

## Общая архитектура

Архитектура проекта состоит из следующих основных компонентов:

1. **Кластер Minikube** - локальный Kubernetes кластер для разработки и тестирования
2. **База данных PostgreSQL** - реляционная БД для хранения данных приложения
3. **Веб-приложение** - простое приложение, взаимодействующее с БД
4. **Blue-Green Deployment** - инфраструктура для обновления приложения без простоя

## Диаграмма компонентов

```
                     ┌────────────────────────────────────────────┐
                     │             Minikube Cluster               │
                     │                                            │
                     │  ┌─────────────┐     ┌─────────────────┐   │
                     │  │             │     │                 │   │
                     │  │  PostgreSQL │◄────┤  Web Application│   │
                     │  │             │     │                 │   │
                     │  └─────────────┘     └────────┬────────┘   │
                     │                               │            │
                     │                               │            │
                     │                      ┌────────▼────────┐   │
                     │                      │                 │   │
                     │                      │    Ingress      │   │
                     │                      │                 │   │
                     │                      └────────┬────────┘   │
                     │                               │            │
                     └───────────────────────────────┼────────────┘
                                                     │
                                            ┌────────▼────────┐
                                            │                 │
                                            │     User        │
                                            │                 │
                                            └─────────────────┘
```

## Blue-Green Deployment

В проекте реализована архитектура Blue-Green Deployment:

```
                  ┌─────────────────────────────────────┐
                  │         Minikube Cluster            │
                  │                                     │
                  │  ┌──────────┐      ┌───────────┐    │
                  │  │          │      │           │    │
                  │  │ Blue App │      │ Green App │    │
                  │  │          │      │           │    │
                  │  └─────┬────┘      └─────┬─────┘    │
                  │        │                 │          │
                  │        │                 │          │
                  │        ▼                 ▼          │
                  │   ┌──────────┐      ┌───────────┐   │
                  │   │ Blue Svc │      │ Green Svc │   │
                  │   └────┬─────┘      └─────┬─────┘   │
                  │        │                  │         │
                  │        └──────┐   ┌───────┘         │
                  │                │   │                 │
                  │             ┌──▼───▼──┐              │
                  │             │         │              │
                  │             │ Router  │              │
                  │             │ Service │              │
                  │             │         │              │
                  │             └────┬────┘              │
                  │                  │                   │
                  └──────────────────┼───────────────────┘
                                     │
                           ┌─────────▼──────────┐
                           │                    │
                           │       User         │
                           │                    │
                           └────────────────────┘
```

## Хранение данных

Для хранения данных PostgreSQL используется следующая структура:

1. **PersistentVolume (PV)** - создается на узле Minikube в директории `/mnt/data`
2. **PersistentVolumeClaim (PVC)** - запрашивает хранилище PV
3. **Deployment PostgreSQL** - использует PVC для сохранения данных

## Конфигурация

Конфигурация компонентов приложения осуществляется через:

1. **ConfigMaps** - для хранения конфигурации приложения и БД
2. **Services** - для организации сетевого взаимодействия
3. **Deployments** - для управления жизненным циклом подов

## Маршрутизация трафика

В Blue-Green Deployment маршрутизация трафика осуществляется через специальный сервис `webapp-router`, который переключает трафик между синей и зеленой версиями в зависимости от выбранных селекторов. 